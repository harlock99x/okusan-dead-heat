<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥¥ã•ã‚“ã®éš£ã€æ­»å®ˆã›ã‚ˆï¼ - èºå‹•ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #859900;
            --bg-color: #fdf6e3;
            --cell-bg: #fff;
            --text-color: #5d4037;
        }

        body { 
            font-family: 'Helvetica Neue', Arial, sans-serif; 
            background-color: var(--bg-color); 
            text-align: center; 
            margin: 0; 
            padding: 10px; 
            color: var(--text-color);
            transition: background-color 0.3s;
        }

        h1 { font-size: 22px; margin: 10px 0; }

        /* ãƒœãƒ¼ãƒ‰ï¼šæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ */
        #board { 
            display: flex; 
            justify-content: flex-start; 
            gap: 8px; 
            margin: 20px auto; 
            padding: 10px;
            overflow-x: auto;
            max-width: 100%;
            -webkit-overflow-scrolling: touch;
        }

        .cell { 
            min-width: 90px; 
            height: 120px; 
            border: 2px solid #d3c6aa; 
            background: var(--cell-bg); 
            border-radius: 12px; 
            display: flex; 
            align-items: flex-end; 
            justify-content: center; 
            font-size: 11px; 
            position: relative; 
            padding-bottom: 8px;
            flex-shrink: 0;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }

        .cell.goal { background: #ffe3e3; border-color: #ff6b6b; font-weight: bold; }

        /* çŒ«ã®é§’ï¼šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¼·åŒ– */
        .piece { 
            width: 50px; height: 50px; 
            border-radius: 50%; 
            position: absolute; 
            border: 3px solid white; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            background-size: cover; 
            background-position: center; 
            z-index: 10;
            top: 15px;
            /* ãƒŒãƒ«ãƒŒãƒ«å‹•ãè¨­å®š */
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            color: white; 
            text-shadow: 1px 1px 2px black;
        }

        .reia { background-color: #5d4037; }
        .mitsune { background-color: #bcaaa4; }
        .pekko { background-color: #333; }

        /* æ“ä½œãƒ‘ãƒãƒ« */
        .controls { 
            background: white; 
            padding: 20px; 
            border-radius: 20px; 
            display: inline-block; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.08); 
            width: 90%; 
            max-width: 400px; 
        }

        .status-bar { font-size: 16px; margin-bottom: 15px; font-weight: bold; }

        button { 
            padding: 15px; 
            font-size: 20px; 
            cursor: pointer; 
            background: var(--primary-color); 
            color: white; 
            border: none; 
            border-radius: 50px; 
            width: 100%; 
            box-shadow: 0 4px #586e75;
            outline: none;
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px #586e75; }
        button:disabled { background: #ccc; box-shadow: none; }

        .log { 
            margin-top: 20px; 
            height: 120px; 
            overflow-y: scroll; 
            background: #f8f9fa; 
            padding: 10px; 
            font-size: 13px; 
            text-align: left; 
            border-radius: 10px;
            border: 1px inset #eee;
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ¼”å‡º */
        #card-display {
            position: fixed;
            top: 45%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            border: 5px solid var(--primary-color);
            padding: 30px;
            border-radius: 20px;
            font-size: 28px;
            font-weight: bold;
            z-index: 100;
            pointer-events: none;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        #card-display.show { transform: translate(-50%, -50%) scale(1.1); }

        /* æ•ã¾ã£ãŸæ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .danger-flash { background-color: #ffcccc !important; }

    </style>
</head>
<body id="main-body">

    <h1>å¥¥ã•ã‚“ã®éš£ã€æ­»å®ˆã›ã‚ˆï¼</h1>

    <div id="board">
        <div class="cell" id="cell0">ä¸»äººã®è…•</div>
        <div class="cell" id="cell1">å»Šä¸‹</div>
        <div class="cell" id="cell2">ãƒªãƒ“ãƒ³ã‚°</div>
        <div class="cell" id="cell3">ã‚½ãƒ•ã‚¡</div>
        <div class="cell" id="cell4">å¯å®¤</div>
        <div class="cell" id="cell5">ãƒ™ãƒƒãƒ‰ä¸‹</div>
        <div class="cell goal" id="cell6">å¥¥ã•ã‚“ã®éš£</div>
    </div>

    <div class="controls">
        <div class="status-bar">æ¬¡ï¼š<span id="current-cat-name">???</span></div>
        <button id="draw-btn" onclick="playTurn()">ã‚«ãƒ¼ãƒ‰ã‚’å¼•ããƒ‹ãƒ£ï¼</button>
        <div class="log" id="log">å¹³å’Œãªå¤œã â€¦</div>
    </div>

    <div id="card-display">ã‚«ãƒ¼ãƒ‰å</div>

    <script>
        const cats = [
            { id: 'reia', name: 'ãƒ¬ã‚¤ã‚¢', pos: 0, class: 'reia', img: 'reia.jpg', type: 'wait', label: 'ãƒ¬' },
            { id: 'mitsune', name: 'ãƒŸãƒ„ãƒ', pos: 0, class: 'mitsune', img: 'mitsune.jpg', type: 'escape', label: 'ãƒŸ' },
            { id: 'pekko', name: 'ãƒšãƒƒã‚³', pos: 0, class: 'pekko', img: 'pekko.jpg', type: 'attack', label: 'ãƒš' }
        ];

        const deck = [
            { name: 'å…¨åŠ›ãƒ€ãƒƒã‚·ãƒ¥', move: 2, msg: 'ãŒçŒ›ãƒ€ãƒƒã‚·ãƒ¥ï¼' },
            { name: 'ã‚¹ãƒ«ã‚¹ãƒ«é€²ã‚€', move: 1, msg: 'ãŒå¿ã³å¯„ã‚‹ã€‚' },
            { name: 'æŠœã‘é“ç™ºè¦‹', move: 3, msg: 'ã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼' },
            { name: 'ä¸»äººã®æŠ±ã£ã“', move: -99, msg: 'ã«æ•ã¾ã£ãŸï¼' },
            { name: 'å¤§é‹å‹•ä¼š', move: 0, msg: 'ç™ºç”Ÿï¼', event: 'shuffle' },
            { name: 'ãŠã‚„ã¤ã‚¿ã‚¤ãƒ ', move: 0, msg: 'ã§å…¨å“¡å‰é€²ï¼', event: 'bonus' }
        ];

        let currentCatIndex = 0;
        let isProcessing = false;

        function updateBoard() {
            document.querySelectorAll('.piece').forEach(p => p.remove());
            cats.forEach(cat => {
                const cell = document.getElementById('cell' + Math.min(cat.pos, 6));
                const piece = document.createElement('div');
                piece.className = `piece ${cat.class}`;
                piece.style.backgroundImage = `url(${cat.img})`;
                piece.innerText = cat.label;

                // é‡ãªã‚Šä½ç½®ã®å¾®èª¿æ•´
                const offset = (cat.id === 'reia') ? -15 : (cat.id === 'pekko' ? 15 : 0);
                piece.style.marginLeft = offset + 'px';
                
                cell.appendChild(piece);
            });
            document.getElementById('current-cat-name').innerText = cats[currentCatIndex].name;
        }

        async function playTurn() {
            if (isProcessing) return;
            isProcessing = true;
            document.getElementById('draw-btn').disabled = true;

            const cat = cats[currentCatIndex];
            const card = deck[Math.floor(Math.random() * deck.length)];
            const cardDisplay = document.getElementById('card-display');
            const body = document.getElementById('main-body');

            // 1. ã‚«ãƒ¼ãƒ‰æ¼”å‡º
            cardDisplay.innerText = card.name;
            cardDisplay.classList.add('show');

            // 2. æ•ã¾ã£ãŸæ™‚ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
            if (card.move === -99) {
                body.classList.add('danger-flash');
                setTimeout(() => body.classList.remove('danger-flash'), 500);
            }

            // 3. æ¼”å‡ºæ™‚é–“å¾…ã¡
            await new Promise(resolve => setTimeout(resolve, 800));
            cardDisplay.classList.remove('show');

            // 4. ãƒ­ã‚¸ãƒƒã‚¯é©ç”¨
            let message = `ã€${cat.name}ã€‘ ${card.name}`;

            if (card.event === 'shuffle') {
                cats.forEach(c => c.pos = Math.floor(Math.random() * 5));
                message = "ğŸ  é‹å‹•ä¼šã ï¼å…¨å“¡ãƒãƒ©ãƒãƒ©ï¼";
            } else if (card.event === 'bonus') {
                cats.forEach(c => c.pos = Math.min(c.pos + 1, 6));
                message = "ğŸ— ãŠã‚„ã¤ï¼å…¨å“¡é‡£ã‚‰ã‚ŒãŸï¼";
            } else if (card.move === -99) {
                if ((cat.type === 'escape' && Math.random() > 0.5) || (cat.type === 'attack' && Math.random() > 0.4)) {
                    message += "â€¦ã‚’è¯éº—ã«å›é¿ï¼";
                } else {
                    cat.pos = 0;
                    message += "ã€‚ã‚¹ã‚¿ãƒ¼ãƒˆã¸â€¦";
                }
            } else {
                cat.pos = Math.min(cat.pos + card.move, 6);
                message += card.msg;
            }

            // ãƒ¬ã‚¤ã‚¢ä¾¿ä¹—
            if (cat.id !== 'reia' && Math.random() > 0.7) {
                const reia = cats.find(c => c.id === 'reia');
                reia.pos = Math.min(reia.pos + 1, 6);
                message += " (ãƒ¬ã‚¤ã‚¢ã‚‚ä¾¿ä¹—)";
            }

            // 5. ç”»é¢æ›´æ–°
            updateBoard();
            document.getElementById('log').innerHTML = `<div>${message}</div>` + document.getElementById('log').innerHTML;

            // 6. å‹åˆ©åˆ¤å®š
            if (cat.pos >= 6) {
                setTimeout(() => {
                    alert(`${cat.name}ã®å‹åˆ©ï¼`);
                    resetGame();
                    isProcessing = false;
                    document.getElementById('draw-btn').disabled = false;
                }, 700);
            } else {
                currentCatIndex = (currentCatIndex + 1) % cats.length;
                isProcessing = false;
                document.getElementById('draw-btn').disabled = false;
                document.getElementById('current-cat-name').innerText = cats[currentCatIndex].name;
            }
        }

        function resetGame() {
            cats.forEach(c => c.pos = 0);
            currentCatIndex = 0;
            updateBoard();
            document.getElementById('log').innerText = "æ–°ã—ã„å¤œãŒå§‹ã¾ã£ãŸâ€¦";
        }

        window.onload = updateBoard;
    </script>
</body>
</html>
